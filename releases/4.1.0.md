# Stencyl 4.1 â€” Development Release

This release is part of **Stencyl 5 development**. While many users are already enjoying the benefits of the new features introduced in this release, and are using it to build and publish games, the design is not yet finalized. It's expected that more changes will be made to toolset configuration, the project model, the extension API, and the engine, any of which could cause a little extra time and care to be required when updating to the next development version.

Notable changes include game sessions, connected device monitor, task manager, issues, decoupled extensions, customizable engine, git integration, hashlink target, easy terminal access, and better debugging support in vscode.

Please try it out by downloading from the below link, and let us know on Discord, on the forum, or on the issue tracker if you have feedback about the new features or if you run into any problems with this release.

## Download

[Multiplatform Release](https://www.stencyl.com/download/get/4.1.0/multiplatform/) (Windows, macOS, Linux)

## Overview

- [Supported Operating Systems](#supported-operating-systems)
- [Distribution Changes](#distribution-changes)
  - [Multiplatform Release](#multiplatform-release)
- Notable Features
  - [Game Sessions](#game-sessions)
  - [Connected Device Monitor](#connected-device-monitor)
  - [Task Manager](#task-manager)
  - [Issues](#issues)
  - [Git Integration](#git-integration)
- [Design Mode Improvements](#design-mode)
- [Other Improvements](#miscellanious)
- [Engine](#engine)
  - [Customizable Engine](#customizable-engine)
  - [Decoupled Extensions](#decoupled-extensions)
- [Extension Development](#extension-development)
- [Building, Testing, Publishing]
  - [Building Games](#building-games)
  - [Testing Games](#testing-games)
  - [Publishing](#publishing-games)
- [Backward Compatibility](#backward-compatibility)
- [Breaking Changes](#breaking-changes)
- [Migration Guide](#migration-notes-for-users)

## Supported Operating Systems

As always, we work to ensure that Stencyl is usable on all of the officially supported versions of the major desktop operating systems.
As far as architectures, this release drops support for 32-bit versions of Windows and adds support for macOS on Apple Silicon.

**Windows**: x64
- Windows 8 - 11 are supported
- Windows 7 with service pack 1 installed should also work

**macOS**: x64 and Apple Silicon
- macOS 11 (Big Sur) through 14 (Sonoma) are supported
- macOS 10.12 (Sierra) through 10.15 (Catalina) should also work
- On older releases, some features may be unavailable, particularly iOS publishing
- Apple Silicon support is incomplete, so some features require Rosetta2

**Linux**: x64
- Ubuntu 18.04 - Ubuntu 22.04 are supported
- Linux systems should be supported in general, given glibc 2.17 or higher

## Distribution Changes

A new distribution format is available: the [multiplatform release](#multiplatform-release).

> note: Installers and other full packages are not provided for the current development releases.

- Windows Installer (`.exe`)
  - Launch Stencyl as non-elevated user after installation, which allows interaction with the File Explorer on the first run
  - Don't allow Stencyl to be installed to a non-empty directory
    - Allow installation to overwrite a folder if Stencyl.exe exists
  - Fix Stencyl registry path on 64-bit Windows
  - Don't open stencyl.com when uninstalling Stencyl

- Windows Installer (`.msi`)
  - Build 64-bit msi installer

- macOS
  - Distribute complete `Stencyl.app` bundles in `.pkg` and `.dmg` releases

- macOS Installer (`.pkg`)
  - Don't install neko to the system

- macOS Disk Image (`.dmg`)
  - Updated the dmg to feature a simple graphical guide to drag-and-drop `Stencyl.app` into the Applications folder

## Multiplatform Release

The multi-platform release of Stencyl is a single package with the following characteristics:
- Portable, in the sense that it can be extracted and run from anywhere without installing
- Contains the necessary files to run Stencyl on all supported operating systems
- No standard executables (`.exe`, `.app`, etc.)
- Small download size
- Java not included, but it will be automatically downloaded if required
- Various Haxe libraries and other tools will be downloaded as-needed while using Stencyl

**First Time Launching Stencyl**

1. Download the multiplatform release.
2. Extract it anywhere you wish.
   - For Windows, avoid the `Program Files` folder. Development releases don't currently support installation to a read-only location.
   - For macOS, avoid the user `Desktop` and `Documents` folders. Otherwise, you need to give Stencyl permission to access those folders when you launch it.
3. Open the extracted folder
4. Double-click the platform-appropriate launcher script to run Stencyl.
   - If on macOS, the first time you run Stencyl after downloading it, you must right-click the launcher and select "Open" from the context menu.
   Linux: `Stencyl-linux.desktop`
   macOS: `Stencyl-macos.command`
   Windows: `Stencyl-windows.bat`
5. Stencyl requires a specific, customized version of Java to run.
   It may not be present if this is your first time running Stencyl, or if the required Java version has been updated.
   In that case, the launcher will offer to download Java. Say yes.
6. The application should start.

**Debugging**

If Stencyl fails to launch, it's helpful to configure the launcher script to *not* close automatically, so that any output can be copied and pasted to ask for more help.

That can be done by setting the `_PRESERVE_TERMINAL_` variable to `true`. To do so, see the "Changing Settings" section below for a quick guide on modifying the launcher.

Once the launch script has been modified, run the respective platform launcher again to see if any errors are printed to the terminal.

**Changing Settings**

Each platform has its own launch script.
- Linux: `launcher/Stencyl-linux`
- macOS: `Stencyl-macos.command`
- Windows: `Stencyl-windows.bat`

Open the appropriate launch script for your platform in a text editor. Near the top of the file is a list of launcher properties that can be changed.

For Windows:
```bat
:: set "_MAX_MEM_=4096"
:: set "_EXTRA_JVM_ARGS_="
:: set "_PRESERVE_TERMINAL_=false"
```

For macOS/Linux:
```sh
# _MAX_MEM_="4096"
# _EXTRA_JVM_ARGS_=""
# _PRESERVE_TERMINAL_="false"
```

In both, each property is preceded by a *comment* marker, which disables that line. To modify a property, the line must first be uncommented. Then, the value to the right of the equals symbol can be changed.

For example, to set the max memory on Windows to 8GB:
```bat
:: set "_MAX_MEM_=4096"
```
becomes
```bat
set "_MAX_MEM_=8192"
```

**Viewing Haxe Source Code**

In previous releases of Stencyl, the Haxe standard library, Haxe libraries, and engine extensions were found in various places in the install folder.
Now, each component is installed as needed and shared across Stencyl installs.

To make it more convenient to view all of the Haxe sources for a particular version of Stencyl, a new menu is available within Stencyl: **Tools > View Folder > View Downloaded Components**
This will create a temporary folder that lists out all of the downloaded components.

- haxelibs: `[install]/plaf/haxe/lib` --> `[components]/haxelib`
- extensions: `[install]/plaf/haxe/extensions` --> `[components]/extensions`
- stdlib: `[install]/plaf/haxe-std` --> `[components]/runtimes/haxe/std`

## Connected Device Monitor

Stencyl games can be run directly on connected Android and iOS devices. This requires the device to be connected to the computer Stencyl is running on, and often requires the computer and the device to be configured appropriately in order for the device to be recognized.

Previous versions of Stencyl didn't provide any indication that a device was recognized. The only way to know if everything worked was to attempt to test a game. After a game was built, Stencyl would simply attempt to send the game to any connected device, and if no devices were recognized, this would fail. This made first-time setup especially troublesome, because after every change in device configuration, the game would need to be rebuilt to test whether the connection was working or not.

The connected device monitor keeps track of all connected devices, and provides the following benefits:

- Device connections are checked at a regular interval, with the "test game" dropdown's label being changed to the name of a connected device
- When testing a game, if multiple devices are present, a specific device can be selected for testing on
- Mobile devices that are connected for debugging over wi-fi can also be tested on
- Android emulators can also be tested on

The device monitor was previously a "beta" feature, which has to be manually enabled in Stencyl's preferences in order to be used.

Here are the changes that have been made since Stencyl 4.0.4:
- Device Manager is no longer a beta feature
- Make device connection checks happen more frequently (every 5 seconds now instead of 30)
- More understandable labels for android emulators and devices connected via wi-fi in the UI
- Update iOS device connection scanner to be faster
- Fix error in IOSDeviceManager if an unknown iOS device is connected

## Game Sessions

A new concept for Stencyl, a "game session" refers to a game in the process of being tested, whether on the desktop, in a browser, or on a mobile device. A game session lasts from when a game is successfully launched until the game is closed.

Currently active game sessions can be viewed in the "Game Controller" window.

An active game session can be right-clicked to show a small set of commands that can be run on the game, such as resetting it, or loading a specific scene.

All logs related to a game session are now gather in the "Log" tab, instead of being interspersed with all of the other application-level logs produced by Stencyl, and the logs of other game sessions.

## Git Integration

### Builtin
- Use a Java git library, JGit, to offer built-in support for some of the most common git commands without needing Git installed on the system
- Initialize a new Git repository with a default gitignore that ignores cached files, backup files, and trash files
- Commit all changes
- Push to, fetch from, and pull from a remote repository
- A crude Git log window, which provides some basic info about each git commit when hovered over
- Use Git configuration files within the workspace (`stencylworks/prefs/.gitconfig`, `stencylworks/prefs/.jgitconfig`)
- Prompt for authorship info at first commit.
- Prompt to configure first remote for a repository if needed at first push/pull/fetch.
- Allow initializing and opening git repositories for each game from the Welcome Center

### External
- Format xml data in a way that's a little friendlier to line-based version control systems
- Automatically reformats your games source files to a canonical form every time you save in order to decrease the chance of merge conflicts
- A Git GUI preference, "Preferences > Editors > Git GUI"
- Adds a new menu item, "Git > Open Git Repository", which opens the Git repo for the open game in your defined Git GUI

## Issues

Sometimes there are problems with a game's settings, data, or code, that can cause an error when you try to test the game, or result in a crash while the game is running. For example, if an event has code to create an Actor Type, but that Actor Type is later deleted, this will cause an error when the game is running and that event occurs.

In addition to issues caused by user action, there are also sometimes issues caused by bugs in Stencyl. For example, in previous versions of Stencyl, copying behaviors with custom blocks often failed to correctly copy all of the necessary information to the new behavior. This could result in the wrong date being deleted or modified when working on either of the behaviors later on.

When possible, Stencyl will now detect such problems, and list them out in the "Issues" window.

Here are some examples of issues that might be detected.

- Design Mode
  - Unknown blocks
    - A block that was removed in a previou version of the Stencyl engine
    - A block from a missing engine extension
    - An attribute getter/setter that corresponds to a deleted attribute
    - A custom block argument that wasn't correctly copied from another behavior
  - Deprecated blocks
  - Blocks with the wrong number of fields
    - A custom block that has added or removed fields since it was placed
  - Block fields with invalid input
    - A number field that contains text
    - An attribute or resource that has been deleted
    - A block that returns an Actor Type being inserted into a field that expects a number
  - Behaviors still using the Stencyl 1.0 file format that didn't support events
  - Custom blocks with invalid specifications

For more information about an issue, it can be hovered over to display a more in-depth summary, and may also present an option to apply an automatic fix.

## Task Manager

When a long-running task needs to be performed, it displays a progress indicator. For example, when opening, saving, or testing a game.

A number of improvements have been made to "task management" in Stencyl.
- Allow long-running tasks to be canceled
- Show multiple tasks at once, and don't forget about tasks that are still running.
- Download multiple files at once, instead of one after another
- A hidden `prefs.autodownload` setting has been added. It defaults to true, and causes tooling downloads (runtimes, libraries, etc., needed to test a game, among other things) to be performed automatically instead of asking for each one.
- The hidden `prefs.exportpopup` setting, which controlled whether a file explorer opened up when a game or resource was exported, has been removed. Instead, there's now a button to open the file explorer if desired whenever something is exported.

## Design Mode

### UI
- Hide event pane checkboxes that can't be toggled ([#1551](http://community.stencyl.com/index.php?issue=1551.0))
- Improve design mode block drawing code to look better on upscaled displays, without ugly gaps inside blocks
- Use the same code for applying color effects to blocks on Windows as Linux and macOS
- Get rid of `(DEPRECATED)` text from deprecated blocks (there's still a small warning icon)

### Model
- Preserve data for unknown blocks
- Allow design mode blocks to differ from the expected number of fields (such blocks will display similar to unloaded blocks)
- Reworked design mode data model to further promote mixed modifications (changes in design mode, changes caused by "fix issues", find+replace). All changes while a behavior is open are properly tracked by the undo/redo system.
- Allow resource/attribute/scene object dropdowns in design mode to show a placeholder when a missing object is selected (such as: missing font reference: 12)
- All changes made to behavior source code in design mode updates the issues window as needed
- Enabling / disabling engine extension causes blocks to load/unload in-place in open behaviors
- For now, due to difficulty in continuing to support it with recent Design Mode changes, actor fields are no longer set to "Self" by default in actor behaviors
- Don't select any value by default for attribute/resource dropdowns
- Unknown blocks can now be shown in the palette
- The type of existing attributes can be changed
- Restore attribute state when a behavior has its changes discarded

### Interaction
- Design Mode click-and-drag block selection, basic mechanism ([#1593](http://community.stencyl.com/index.php?issue=1593.0))
- Select blocks by clicking/right-clicking on them

### Copy/Paste
- Accept raw xml when pasting into the edit area, and make all failures result in an error dialog
- Allow pasting xml block groups without attribute information
- If copied variable information is present when loading from xml, always use it. (this allows accurately copying code between events with the same ID in different games)
- Allow copied + pasted blocks to carry over attributes in more places. (attribute dropdowns and goc/bsoc fields)
- Copy blocks to plain xml instead of base64 (this is a nicer format for sending code snippets, but can't be pasted into Stencyl 4.0.4 and older)
- Fixed behavior of "cut" action. Previously it would copy the current block and all blocks connected under it, but only the first block would be deleted.

### Undo/Redo
Many undo/redo bugs were fixed. In addition, the following actions are now included in the undo/redo history:
- Creating/removing attributes
- Creating/removing custom blocks
- Block activation/deactivation
- Event activation/deactivation
- Event renaming

### Custom Blocks
- Allow custom blocks to be modified (including parameters and return type) after creation
- Add custom block preview to the custom block editing dialog
- Add "go to receiver" menu item on custom blocks to jump to the source code of the custom block
- Add a new rule to custom block specifications: all defined fields should be visible

### Find + Replace
- Allow searching for blocks within a behavior (`Edit->Find and Replace`, or `[ctrl]+[f]`)
- Allow searching for blocks across an entire project (`Tools->Find`, or `[ctrl]+[shift]+f`)
- Allow structural find+replace with special capture and wildcard blocks (replace not implemented yet for project-wide search?)
- The old "find in behaviors" window is replaced with the new project-wide search results window
- When right-clicking on any block related to an attribute or named property, that attribute/property can be searched for (game attribute, behavior attributes, actor properties)

### Performance
The time it takes to load a behavior for editing has been significantly reduced by deferring the loading of design mode blocks until their container is made visible. This includes: loading the blocks in the palette, which is a baseline cost that all behaviors paid; and loading all of the blocks in every event, which depends on the number of blocks in the behavior.

### Other
- Jumping to an error in Design Mode now actually takes you to the highlighted block (or the first one if there are multiple)
- For blocks with errors, if the error can be fixed automatically (like deprecated blocks that have a replacement available), the automatic fix can be applied by right-clicking on the block and choosing "Quick Fix"
  
### Code Generation
- Code generation no longer relies on loading blocks in Design Mode
- Fix errors that could cause code for the wrong field to be generated within a block.
- Add event conditions based on extension compatibility
- Create AutoIfdef code element for extensions with limited compatibility
- Add semicolon after unknown and deprecated blocks for better compilation errors
- Improve formatting of comment-wrapper block to more closely match it's Design Mode representation
- Don't wrap code inputs in number fields with `asNumber`
- Fixed a spacing issue that could cause an error in generated code when the last block in a "when created" event is a "do only on [platform]" block.
- Automatically wrap platform-specific extension blocks in platform guards. Blocks that return a result will return either `0`, `false`, `""` (empty text), or `null` depending on the expected return type of the block.
- Attribute access using the blocks in "Behaviors > Attributes" now uses direct access where possible instead of reflection
  - This will cause a compilation error if a behavior or attribute name has a typo, or you try to assign or access a wrong type.

## Miscellanious

### General Interface Changes
- Try to always sort by natural order instead of lexical order where applicable (when listing games, resources, behaviors, attributes, etc)
- For performance reasons, use standard scrollbars instead of the ones that are customized to look like macOS c. 2000
- Draw a subtle border on colored buttons when focused
- Always pause animations when yes/no/cancel prompts are shown (this was generally the case before, but some were missed)
- Give keyboard focus to the scene list when a game is first opened

### Translations
- For phrases with substitutions, ignore translations that don't match the format of the original English phrase

### Preferences
- Making changes to language settings prompts to restart Stencyl ([#2009](http://community.stencyl.com/index.php?issue=2009.0))

### Welcome Center
- Add a link to the discord chat to the welcome center. Fix up bad redirect for blog
- Allow initializing and opening a git repository for a game before opening it (in right-click menu)
- Add "rename" option to games in the Welcome Center

### Importing Resources
- Use the file name for the new animation name when importing an image into the animation editor
- On macOS, drag and drop import from finder doesn't work with paths with emoji ([#1888](http://community.stencyl.com/index.php?issue=1888.0))
- Apply image size correction when importing high-scale images by drag

### Game Data Model
- Always use game name from file path, instead of the `name` key in `game.xml`
- Automatically include `[game]/lime-templates` as a lime template folder

### Game Settings
- When creating a new android certificate, if one already exists, ask if it's ok to overwrite before asking for the new certificate details instead of after
- Fix: when overwriting previously created android certificates, pressing cancel on the cancellation prompt didn't actually cancel the overwrite
- When importing an engine extension that already exists, completely overwrite the old one to avoid errors caused by merging two versions of an extension
- Engine extensions are sorted by name, with missing engine extensions showing first

### Actor Type Editor
- Only do transparency conversion once when importing multiple frames

### Background Editor
- Fix: newly created backgrounds have incorrect `imagesLoaded` state ([#1974](http://community.stencyl.com/index.php?issue=1974.0))

### Tileset Editor
- Add copy/paste buttons to animated tile editor
- Fix: duplicated tilesets have an incorrect `imagesLoaded` state ([#1995](http://community.stencyl.com/index.php?issue=1995.0))

### Bitmap Font Editor
- Changes to how spacing and line height are stored and interpreted, to better respect the BMFont spec
- Fix: Bitmap font's line height is reset every time you open the font ([#1973](http://community.stencyl.com/index.php?issue=1973.0))
- Fix: Unable to re-import same file in BMP font editor ([#1957](http://community.stencyl.com/index.php?issue=1957.0))

### Scene Editor
- Fix tile equality check (this could manifest as scenes blending tile runs with the same id from different tilesets together when saving)
- Fix some offset errors for box regions (This is a bug starting in v4.0.0 that could cause regions to appear in the wrong place)

### List/Map Editor
- Set the default encoding for importing lists and maps to UTF-8 (fixes importing non-ascii text).

### External Editors
- Fix passing arguments to external code editors on macOS.

### HTTPS Support
- Updated all links toward stencyl.com to use https instead of http
- Fix errors using extension repositories with https urls

### Xcode
- Don't perform a recursive search in `DeviceTypes` and `CoreSimulator/Devices` folders (bug since 4.0.1)
- Fix race condition in Xcode detection with `xcode-select`
- Fix Stencyl not being able to parse 3-part Xcode version numbers
- Detect attached iOS device runtimes using xctrace if using Xcode 13+ (before, we tried to use instruments, which would fail on Xcode 13+)
- Fix Xcode not being detected if it prints warnings in addition to the desired output when `xcodebuild -version` is called
- Improved Xcode path setup for case-insensitive paths
- Scan for separately downloaded iOS simulator runtimes, which is the norm beginning in Xcode 15

### Android Tools
- Range of supported JDKs for building Android games is now 17-21.
- Allow Android APIs up to 34 (Android 14).
- Fix platform-tools not updating successfully if adb is running by stopping adb.
- Fix android tools installations sometimes losing permissions on macOS, leading to build errors
- Show error dialog if parts of the Android SDK failed to install.
- Add info for recent Android NDKs (16-24)

## Engine

### New blocks
- Include block to restore game attributes, print saving errors in debug
- Added block to enable/disable saving for game attributes ([#362](http://community.stencyl.com/index.php?issue=362.0))
- Added new block to get the column/row of the collided tile ([#749](http://community.stencyl.com/index.php?issue=749.0))
- Blocks for getting safe area insets on mobile devices ([#1933](http://community.stencyl.com/index.php?issue=1933.0))

### Updated blocks
- Remove hidden actor field for time-related blocks.
- Fix missing actor field for the "last added shape" block.

### General
- Allow many-to-many control mappings.
- Don't use pseudo-unicode anymore.
- Fix stacking of image effects ([#2055](https://community.stencyl.com/index.php?issue=2055.0))
- Make "get scene by name" always return null for scenes that don't exist
- Modify the event system so that it can be used by extensions, without needing to define every type of event in the engine.
- Built-in extensions have been decoupled from the engine. The extension-related code that was previously in the engine is now found in each individual extension instead.
- Effects for images and actors now use the gpu instead of the cpu on targets other than Flash.
- Don't wait for game controller connection by default. Let the connection be performed after the game has already started.

### HTML5
- Prevent default action of arrows and space bar on web pages. (third issue in [#1538](http://community.stencyl.com/index.php?issue=1538.0))
- Disable AssetCache random versioning
- Cache unchanged drawing calls, as was already done on desktop/mobile

### Web
- rob1221's sitelock suggestions ([#1665](http://community.stencyl.com/index.php?issue=1665.0))
   1. Ability to use wildcards
   2. Fix: The link that is opened is the full sitelock string, even if that represents multiple URLs
   3. Fix: Text is too small (we may want to allow more customization of this in the future)
- Move preloader code from toolset to engine
- Split preloader and sitelock code apart
- Enable right/middle mouse buttons on HTML5 and Flash ([#1673](http://community.stencyl.com/index.php?issue=1673.0))

### Mobile
- Fix android/ios autorotate setting ([#47](http://community.stencyl.com/index.php?issue=47.0))

### Android
- Fix android screen edges on displays with cutouts ([#1771](http://community.stencyl.com/index.php?issue=1771.0))
- Fix Android API 30 black screen and crash

### iOS
- Fix: iOS 15 with iPhone 12+ crashes on launch ([#2024](https://community.stencyl.com/index.php?issue=2024.0))
- Don't hide launch storyboard on iOS until game is fully loaded ([#1946](http://community.stencyl.com/index.php?issue=1946.0))
- Try to fix audio pops at start of sounds on iOS ([#1294](https://community.stencyl.com/index.php?issue=1294.0))
- [iOS] Don't add a space at the start of soft keyboard input
- Fix safe area insets on recent iOS versions
- Add more iPad resolutions for the iPad block

### Documentation
- Add haxe api docs generator to stencyl haxelib

### Libraries
  - Haxe, 4.1.5 -> 4.2.1
  - Hxcpp 4.1.0 -> 4.2.0
  - Hscript 2.1.1 -> 2.5.0
  - Lime 7.8.0 -> 8.0.1
  - OpenFL 8.9.5 -> 9.2.0
  - Box2D includes some small performance fixes too


### Customizable Engine

Sometimes it's desired to modify the Stencyl engine for a specific project. This has been possible since the first release that featured the Haxe engine, Stencyl 3. But it involved modifying the engine found within the Stencyl install folder. As such, any modifications to the engine would apply to any game that was built with that installation of Stencyl. Further, any changes to the engine that involve the pre-defined blocks and events were impossible, since blocks and events were all defined within the toolset.

With this release:
- The engine is more self-contained (blocks and events are completely defined by the engine, not the toolset)
- The engine can be vendored for a particular project, by copying it and placing it into a project's `engine-extensions` folder.

### Decoupled Extensions

Since the introduction of engine extensions in Stencyl 3, a small number of officially supported engine extensions have been included in Stencyl. In some cases, those engine extensions have had deep integration with the toolset, giving them capabilities that were not available to user-built engine extensions.

Two significant changes have been made here:

1. The engine extension capabilities that were not available to user-built extensions are now available (primarily modify palette, add events, game-specific data)
2. The built-in engine extensions have been modified to make use of these new generic capabilities instead of their custom deep integration.
3. Using these new extension capabilities, the built-in engine extensions have been decoupled from the toolset and the engine.

The following built-in engine extensions are no longer tightly coupled to the IDE or to the engine.
This means that they can be freely enabled, disabled, or modified to suit the current project.

### AdMob

- Fix errors with unspecified banner/interstitial id for Admob on Android
- Decouple AdMob extension and update it
  1. Updated to more recent Android/iOS SDKs.
  2. Implemented "rewarded" and "rewarded interstitial" ad formats.
  3. Google's UserMessagingPlatform is used for getting player tracking consent. The "set privacy url" block is deprecated.
     The privacy URL needs to be set in the online dashboard instead.
  4. Blocks for debugging user consent, as well as for limiting the ad pool (child-directed, max content rating) are added.
  5. Fix banner ad height block reporting wrong size.

### GameCenter
- Decouple iOS Gamecenter extension
- Add game center entitlement automatically when game center extension is enabled.

### Google Play Games
- Decouple Google Play Games extension
- Play services games library updated from 10.0.1 to 23.1.0
- Quest blocks, which have long been unsupported, have been deprecated.

### Purchases
- Decouple Purchases extension
- Update purchases to use Android Billing v6.0.1. ([#1984](http://community.stencyl.com/index.php?issue=1984.0))
- The "enable purchases" checkbox now applies to both Android and iOS instead of just Android.

### On-screen Joysticks
- Partially decouple joystick extension
- Don't move joystick center on release when custom `outerRadius` is set
- Fix onscreen joystick input with view offset
- Fix onscreen joystick on windows/linux and when `Engine.SCALE > 1`

### Gestures
- Fix null pointer error when a swipe occurs between scenes

### Labels
- Import some label-related code that was in the core engine

### Native (Mobile Functionality)
- The native extension has been placed into the Stencyl engine itself instead of living on as a stand-alone extension.

## Extension Development

### New Capabilities for Engine Extensions
- Let an extension include a toolset extension for deeper integration with the toolset
- Let extensions be localized (while this was meant to be introduced for Stencyl 4, it was broken)
- Let an extension declare itself as a haxelib (by including a `haxelib.json` file)
- Extensions can add new attribute types based on Haxe types
- `blocks.xml` changes
  - The `blocks.xml` file is no longer necessary
  - Add a new type of field, `code`, which just enters what the user types into the block with no changes
  - Allow dropdown data to be shared by multiple blocks
  - Allow blocks to use custom code generators (defined by toolset extensions)
  - Per-field default values in block definitions
  - Allow block labels and help text to be translated
  - Allow blocks to be marked as deprecated
- Let extensions be configured (for example, set API keys, debug settings, etc)
- Let extensions contribute to the palette and the event listing
- Let an extension define a main "Extension" class, which can hook in to the engine in more places
- For flash/html5, let an extension provide its own sitelock
- For iOS, let extensions provide additional values for the `{{game}}-Info.plist` and `{{game}}.entitlements` files.
- For iOS, let extensions grab dependencies from Cocoapods.

Extensions:
- For native android extensions:
  - Updates (Gradle 5.6.3 -> 8.5, Android Gradle Plugin 3.5.1 -> 8.1.3)
  - Move from legacy `appcompat` to `androidx.appcompat`
  - The min/target sdk versions are specified in build.gradle. See: [#1988](http://community.stencyl.com/index.php?issue=1988.0)

## Migration notes for extension developers

- Fix building games for Android 12+
  https://community.stencyl.com/index.php?issue=2073.0
  > Apps targeting Android 12 and higher are required to specify an explicit value for
  > `android:exported` when the corresponding component has an intent filter defined.
  > See https://developer.android.com/guide/topics/manifest/activity-element#exported
  > for details.
- `namespace` must be specified since AGP 8+
- https://developer.android.com/build/configure-app-module#set-namespace
- 18c1a3eb45cbf48fbdfac6bb88878fb507bdea97 Remove superfluous onGameOpened call after first loading an extension
- 27f20ef1849b21e44624345e0bc2b8dc21cbd15d Add toolset extension enabled/disabled events.
- The "game" category of toolset extensions no longer exists. Instead, an engine extension can bundle a toolset extension for deeper integration with Stencyl if needed.

## Building Games

### General
- Avoid copying game assets and generated game code when not necessary to speed up builds, especially with large "extras" folders.
- Haxe compilation server as beta feature
- Don't show ansi escape codes for coloring in OpenFL's log output
- Generate Haxelib folder per-game at build time
     This can be useful for build tooling, because it's possible to look up the path of included haxelibs in lime and hxcpp
  - Extensions that contain a `haxelib.json` are included as haxelibs in `project.xml`
  - The `HAXELIB_PATH` environment variable is now set to `game-generated/[game]/Haxelib`, which points to each of the installed haxelibs using the `.dev` file

### Windows
- Do not cache the results of the visual studio check between sessions. This caused Stencyl to sometimes think that Visual Studio was available when it wasn't, leading to compiler errors.

### Android
- Always pass `--stacktrace` to gradle
- Ensure removal of stale files from previous android asset updates
- Pass higher max memory (4GB) for gradle daemon on 64-bit systems
- A user-provided JDK is no longer required for Android builds ([#1945](http://community.stencyl.com/index.php?issue=1945.0))

### iOS
- Allow Xcode to be opened from outside of Stencyl and successfully build Stencyl projects with no workarounds by storing info about the Stencyl install in the generated Xcode project.
- Fix parsing of `codesign -d --entitlements` on macOS 12.

## Testing Games

### Targets
- Added Hashlink target

### Launching
- Launch OpenFL games from saved clients with another thread to avoid blocking UI
- Allow internally passing simple arguments to launched games on all supported platforms
- Using argument passing, the "test scene" button should now always work, even if the game controller is enabled but a connection can't be established
- Remove "Flash (Browser)" testing option
- Add an "HTML5 (Remote)" run option, which doesn't start the game in the default browser, but instead shows a message with the url to enter into a browser on another computer or mobile device.
- Serve HTML5 games directly from the OpenFL output folder (speeds up testing for games with many assets)
- Don't use chunked transfer encoding in http server to avoid occasional issues loading games when testing ([#2082](https://community.stencyl.com/index.php?issue=2082.0))
- A specific android device (including devices connected physically and via wi-fi, as well as emulators) can be chosen when launching a game for testing
- Install android games before trying to launch them from game controller
- Don't kill existing iOS simulators before launching a game on an iOS Simulator

### Logging
- Game-specific logging is now always enabled. Logs for a game session are viewed in the "game controller" window.
- Write game-specific logs to a file in addition to the log viewer. `stencylworks/logs/[game name]/[date]-[platform]/game_controller.log`
- Printing attributes with an associated image (actors, images, image instances) shows those images in the game session's log
- Null access errors don't cause a crash, but are logged instead
- Fix iOS device logs sometimes not showing right away ([#2102](https://community.stencyl.com/index.php?issue=2102.0))
- Logs can now be gathered from multiple sources.
  - For example, on Flash, both the Stencyl "print" block, which is under our control, as well as direct calls to the AS3 `trace` statement which could be made by third-party swfs, will be seen in the log viewer.
  - Another example, on iOS, the native `NSLog`/`OSLog` calls are additionally gathered in the log viewer.

### Debugging
- Add debug option for android devices, emulators, and iOS simulators
- Add `hxcpp-debugging` support, possible through VSCode
- Always include `HXCPP_DEBUG_LINK` by default, with option to disable
- Always include debug symbols if `HXCPP_DEBUG_LINK` is defined (in particular, fixed a Windows-only omission of debug info for many Lime/OpenFL source files)
- Expand VSCode `launch.json` with more debuggers

## Publishing Games

### Android
- Added an option to publish to the `.aab` (Android App Bundle) format. The `.apk` format remains as another publishing options.

### iOS
- Fix: Not stripping `get-task-allow` when publishing iOS App with "Apple Distribution" certificate
- Fix Xcode project export not picking up the current version of the project

### HTML5
- Pack assets by default when publishing HTML5 games
- Fix html5 games not loading on itch.io and some other sites when asset packing is enabled ([#2011](http://community.stencyl.com/index.php?issue=2011.0))
- Use custom index file that shows a progress bar until scripts are loaded
- Disable source map processing in closure
- A user-provided JDK is no longer required to publish HTML5 games ([#1945](http://community.stencyl.com/index.php?issue=1945.0))

## Backward Compatibility

These are bugs that interfered with Stencyl's ability to load games created in older versions.

#### pre-2.0 compatibility

- Allow code generators to work with behaviors created in Stencyl 1.x, before events
  If a behavior from before events is in a game that's updated, it won't generate its code properly without first being opened in Design Mode.
  Allow events to be generated as needed by code builders to get around this.
- Check if custom event uses attribute for trigger
  If an old behavior uses an attribute block for a custom event trigger, use that block in determining the name of the event.

#### pre-3.0 compatibility

- Don't forget which scene is the starting scene when updating.
- Only enable the 1x scale when importing games with no scale information.

#### pre-3.1.0 compatibility

- When opening a project from before Stencyl 3.1.0, add explicit collision groupings that were previously implicitly defined defaults.

#### pre-4.0.1 compatibility

- Don't delete conflicting shapes, just give them a new ID.
  Until Stencyl 4.0.1, there was a bug that caused multiple shapes with the ID -1 to be created when doing a drag-and-drop import. The ID being -1 has nothing to do with it, but the issue was "fixed" by not using -1 for new shapes, and deleting existing shapes with that ID.
  This is problematic for older projects, which may have valid shapes with the ID -1.
  With this change, shapes are not deleted, but instead given a new ID if their existing ID conflicts with other shapes.

#### Added Missing Block Converters

- "Touch" events and "this actor collides with" events were both removed from the event listing for Stencyl 3.0 in 2012.
  Though deprecated, they remained functional until Stencyl 4.0.3.
- `remove-bglayer` was completely replaced with `remove-layer` during Stencyl 3.5 beta 2 in 2018.
  A converter was not added at the time, which was a mistake.
- "as animation" is simply removed if found, as it hasn't had any effect since Stencyl 3.
- "change number", if it uses the old form from before Stencyl 3.4.0-beta3, where the internal name of a number attribute was typed in to the first field.
- `ignore-screen-tolerance`
- `bullet-mode`
- `collision-shape-group-me`
- `collision-shape-group`
- `scene-reload-new`/`scene-change-new`
- `set-game-att-num`/`set-game-att-text`/`set-game-att-bool`/`set-game-att-list`
- `get-game-att-num`/`get-game-att-text`/`get-game-att-bool`/`get-game-att-list`
- `get-item-number`/`get-item-text`
- `plusplus`/`minusminus`

## Breaking changes

**OS Support**
- Dropped support for running Stencyl on 32-bit Windows systems

**Toolset Extensions**
- No existing *toolset* extensions will work anymore, and must be updated for Stencyl 5.

**Bitmap Fonts**
- The way that bitmap font files are parsed has been modified to be closer to the original [BMFont](https://www.angelcode.com/products/bmfont/) format.

**Design Mode**
- Time-related blocks (do after, do every) have had their definition modified to remove an invisible "Actor" input.
- On actors, custom blocks that hide the "self" parameter in their spec are considered invalid.

Uncommon breaking changes:
- The hidden setting to override the path to the Haxe compiler and standard library has been removed.
- The ability to override the palette and event listing by placing files in the workspace has been removed.
- The project.xml and index.html files have been changed significantly, so overrides to those files will no longer work.

---

## Migration notes for users

Previously, when opening a Stencyl project created in an old version of Stencyl, a prompt would appear asking if you want to update your game to the new format. If you said no, the game would be closed. If you said yes, the game would be modified and then saved. This has been removed for now, but may be brought back again before the final Stencyl 5 release. Instead, use the following guide to update your games.

**If you use the modified launch script to increase the amount of memory available to Stencyl...**
Stencyl now launches with 4GB available by default. This should be enough for most users, but if it's not, you can modify the memory limit by changing the `_MAX_MEM_` setting in the launch script. See [Multiplatform Release/Changing Settings](#changing-settings).

**If you use bitmap fonts...**
Use the menu action **Tools > Game > Adjust bitmap font line heights** to automatically ensure that none of your bitmap fonts specify a line height that's too small.

**If you use the built-in AdMob extension**
The "set privacy url" block is deprecated. The privacy URL needs to be set in the online dashboard instead.

**If you use the built-in purchases extension on Android...**
- Purchases API updates. ([#1984](http://community.stencyl.com/index.php?issue=1984.0))

**If you use the built-in purchases extension on iOS...**
- Ensure that the "purchases" checkbox is enabled

**If you have a custom project.xml or index.html...**

**If you use any toolset extensions...**

**If your game includes any deprecated or broken blocks (this is basically all games)**
- Use issues > fix all

For the final release of v5, it's planned to make the following things automatic:
- bitmap font updates
- block conversions